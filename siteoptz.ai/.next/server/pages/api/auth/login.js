"use strict";(()=>{var e={};e.id=908,e.ids=[908],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4718:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},5950:(e,t,r)=>{r.r(t),r.d(t,{config:()=>c,default:()=>l,routeModule:()=>u});var s={};r.r(s),r.d(s,{default:()=>i});var o=r(9762),n=r(6059),a=r(4718);async function i(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});t.setHeader("Access-Control-Allow-Credentials",!0),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET,OPTIONS,PATCH,DELETE,POST,PUT"),t.setHeader("Access-Control-Allow-Headers","X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version");let{email:r,password:s}=e.body;if(!r||!s)return t.status(400).json({success:!1,error:"missing_fields",message:"Email and password are required"});try{let e=process.env.GHL_API_KEY||"pit-8954f181-e668-4613-80d6-c7b4aa8594b8",o=process.env.GHL_LOCATION_ID||"ECu5ScdYFmB0WnhvYoBU",n=`https://services.leadconnectorhq.com/contacts/?query=${encodeURIComponent(r)}&locationId=${o}`,a=await fetch(n,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",Version:"2021-07-28"}});if(!a.ok)throw Error("Failed to search contacts");let i=((await a.json()).contacts||[]).find(e=>e.email===r);if(!i)return t.status(404).json({success:!1,error:"user_not_found",message:"No account found with this email. Please create an account.",action:"redirect_to_register"});if(s.length<6)return t.status(401).json({success:!1,error:"invalid_password",message:"Invalid password. Please try again."});console.log("Contact found:",{id:i.id,email:i.email,tags:i.tags,firstName:i.firstName,lastName:i.lastName});let l={"siteoptz-plan-free":"free","siteoptz-plan-starter":"starter","siteoptz-plan-pro":"pro","siteoptz-plan-enterprise":"enterprise"},c="free";if(i.tags){let e=Array.isArray(i.tags)?i.tags:[];for(let t of(console.log("Tags found:",e),e)){let e="string"==typeof t?t:t.name||t.tag||"";if(console.log("Checking tag:",e),l[e]){c=l[e],console.log("Plan found:",c);break}}}"free"!==c||i.tags&&0!==i.tags.length||console.warn("No plan tags found for user:",r,"- defaulting to free plan");let u={id:i.id,email:i.email,name:`${i.firstName||""} ${i.lastName||""}`.trim()||i.name||"User",plan:c,tags:i.tags||[],authenticated:!0,loginTime:new Date().toISOString()};return t.status(200).json({success:!0,message:"Login successful",user:u,redirectUrl:`https://siteoptz.ai/dashboard/${c}`})}catch(e){return console.error("Login error:",e),t.status(500).json({success:!1,error:"server_error",message:"An error occurred during login. Please try again."})}}let l=(0,a.l)(s,"default"),c=(0,a.l)(s,"config"),u=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/auth/login",pathname:"/api/auth/login",bundlePath:"",filename:""},userland:s})},6059:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},9762:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=5950);module.exports=r})();