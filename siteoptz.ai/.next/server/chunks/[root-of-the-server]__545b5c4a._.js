module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},96428,e=>{"use strict";var t=e.i(26747),r=e.i(90406),a=e.i(44898),s=e.i(62950);async function n(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});t.setHeader("Access-Control-Allow-Credentials",!0),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET,OPTIONS,PATCH,DELETE,POST,PUT"),t.setHeader("Access-Control-Allow-Headers","X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version");let{email:r,password:a}=e.body;if(!r||!a)return t.status(400).json({success:!1,error:"missing_fields",message:"Email and password are required"});try{let e=process.env.GHL_API_KEY||"pit-8954f181-e668-4613-80d6-c7b4aa8594b8",s=process.env.GHL_LOCATION_ID||"ECu5ScdYFmB0WnhvYoBU",n=`https://services.leadconnectorhq.com/contacts/?query=${encodeURIComponent(r)}&locationId=${s}`,o=await fetch(n,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",Version:"2021-07-28"}});if(!o.ok)throw Error("Failed to search contacts");let i=((await o.json()).contacts||[]).find(e=>e.email===r);if(!i)return t.status(404).json({success:!1,error:"user_not_found",message:"No account found with this email. Please create an account.",action:"redirect_to_register"});if(a.length<6)return t.status(401).json({success:!1,error:"invalid_password",message:"Invalid password. Please try again."});console.log("Contact found:",{id:i.id,email:i.email,tags:i.tags,firstName:i.firstName,lastName:i.lastName});let l={"siteoptz-plan-free":"free","siteoptz-plan-starter":"starter","siteoptz-plan-pro":"pro","siteoptz-plan-enterprise":"enterprise"},d="free";if(i.tags){let e=Array.isArray(i.tags)?i.tags:[];for(let t of(console.log("Tags found:",e),e)){let e="string"==typeof t?t:t.name||t.tag||"";if(console.log("Checking tag:",e),l[e]){d=l[e],console.log("Plan found:",d);break}}}"free"!==d||i.tags&&0!==i.tags.length||console.warn("No plan tags found for user:",r,"- defaulting to free plan");let c={id:i.id,email:i.email,name:`${i.firstName||""} ${i.lastName||""}`.trim()||i.name||"User",plan:d,tags:i.tags||[],authenticated:!0,loginTime:new Date().toISOString()};return t.status(200).json({success:!0,message:"Login successful",user:c,redirectUrl:`https://siteoptz.ai/dashboard/${d}`})}catch(e){return console.error("Login error:",e),t.status(500).json({success:!1,error:"server_error",message:"An error occurred during login. Please try again."})}}e.s(["default",()=>n],35117);var o=e.i(35117),i=e.i(7031),l=e.i(81927),d=e.i(46432);let c=(0,s.hoist)(o,"default"),u=(0,s.hoist)(o,"config"),p=new a.PagesAPIRouteModule({definition:{kind:r.RouteKind.PAGES_API,page:"/api/auth/login",pathname:"/api/auth/login",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function g(e,r,a){p.isDev&&(0,d.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/auth/login";s=s.replace(/\/index$/,"")||"/";let n=await p.prepare(e,r,{srcPage:s});if(!n){r.statusCode=400,r.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve());return}let{query:o,params:c,prerenderManifest:u,routerServerContext:g}=n;try{let t=e.method||"GET",a=(0,i.getTracer)(),n=a.getActiveScopeSpan(),d=p.instrumentationOnRequestError.bind(p),f=async n=>p.render(e,r,{query:{...o,...c},params:c,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:u.preview,propagateError:!1,dev:p.isDev,page:"/api/auth/login",internalRevalidate:null==g?void 0:g.revalidate,onError:(...t)=>d(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let e=a.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=e.get("next.route");if(o){let e=`${t} ${o}`;n.setAttributes({"next.route":o,"http.route":o,"next.span_name":e}),n.updateName(e)}else n.updateName(`${t} ${s}`)});n?await f(n):await a.withPropagatedContext(e.headers,()=>a.trace(l.BaseServerSpan.handleRequest,{spanName:`${t} ${s}`,kind:i.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},f))}catch(e){if(p.isDev)throw e;(0,t.sendError)(r,500,"Internal Server Error")}finally{null==a.waitUntil||a.waitUntil.call(a,Promise.resolve())}}e.s(["config",0,u,"default",0,c,"handler",()=>g],96428)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__545b5c4a._.js.map