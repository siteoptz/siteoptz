module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},78042,(e,t,r)=>{t.exports=e.x("next-auth-c77c3a03231bb629",()=>require("next-auth-c77c3a03231bb629"))},92670,(e,t,r)=>{t.exports=e.x("next-auth-c77c3a03231bb629/providers/google",()=>require("next-auth-c77c3a03231bb629/providers/google"))},34733,e=>{"use strict";var t=e.i(26747),r=e.i(90406),n=e.i(44898),o=e.i(62950),a=e.i(78042);async function i(e){try{if(!process.env.GHL_API_KEY||!process.env.GHL_LOCATION_ID)return console.log("GHL credentials not configured"),null;let t=await fetch(`https://services.leadconnectorhq.com/contacts/search/duplicate?email=${encodeURIComponent(e)}`,{method:"GET",headers:{Authorization:`Bearer ${process.env.GHL_API_KEY}`,Version:"2021-07-28","Location-Id":process.env.GHL_LOCATION_ID}});if(!t.ok)return console.error("GHL search failed:",t.status),null;let r=await t.json();if(r.contact)return console.log("âœ… Found existing GHL contact:",e),r.contact;return console.log("â„¹ï¸ No GHL contact found for:",e),null}catch(e){return console.error("GHL search error:",e),null}}async function s(e,t,r="free"){try{if(!process.env.GHL_API_KEY||!process.env.GHL_LOCATION_ID)return console.log("GHL credentials not configured - skipping contact creation"),null;let n=await fetch("https://services.leadconnectorhq.com/contacts/",{method:"POST",headers:{Authorization:`Bearer ${process.env.GHL_API_KEY}`,Version:"2021-07-28","Content-Type":"application/json","Location-Id":process.env.GHL_LOCATION_ID},body:JSON.stringify({email:e,name:t,tags:[`siteoptz-plan-${r}`],source:"Google OAuth"})});if(!n.ok){let e=await n.text();return console.error("GHL create contact failed:",e),null}let o=await n.json();return console.log("âœ… Created new GHL contact:",e,"with plan:",r),o.contact}catch(e){return console.error("GHL create contact error:",e),null}}let l={providers:[(0,e.i(92670).default)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,authorization:{params:{prompt:"consent",access_type:"offline",response_type:"code"}}})],secret:process.env.NEXTAUTH_SECRET,session:{strategy:"jwt",maxAge:2592e3},pages:{signIn:"/login",error:"/login"},callbacks:{async signIn({user:e,account:t,profile:r}){if(console.log("ðŸ”¥ OAuth Sign In Attempt:",{email:e?.email,provider:t?.provider,profileEmail:r?.email}),t?.provider==="google"&&(!process.env.GOOGLE_CLIENT_ID||!process.env.GOOGLE_CLIENT_SECRET||process.env.GOOGLE_CLIENT_ID.includes("your-")||process.env.GOOGLE_CLIENT_SECRET.includes("your-")))return console.error("âŒ Google OAuth not properly configured!"),console.error("Please set GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET in Vercel environment variables"),!1;if(t?.provider!=="google")return!0;if(!e?.email)return console.error("âŒ No email provided from Google OAuth"),!1;try{return await i(e.email)?console.log("âœ… Existing user found in GHL:",e.email):(console.log("ðŸ†• New user via OAuth, creating in GHL:",e.email),await s(e.email,e.name||"User","free")),!0}catch(e){return console.error("âš ï¸ Sign in callback error:",e),!0}},async redirect({url:e,baseUrl:t}){console.log("ðŸ”„ Redirect callback:",{url:e,baseUrl:t});let r=e.split("#")[0];if(r.includes("/api/auth/callback/google")||r===t||r===t+"/"||r.includes("/login"))return console.log("âœ… Redirecting to dashboard after OAuth sign in"),`${t}/dashboard`;if(r.includes("error=OAuthCallback"))return console.log("âŒ OAuth error detected, redirecting to login with error"),`${t}/login?error=OAuthCallback`;if(r.startsWith("/"))return`${t}${r}`;try{let e=new URL(r),n=new URL(t);if(e.origin===n.origin)return r}catch(e){console.error("Invalid redirect URL:",r)}return`${t}/dashboard`},async jwt({token:e,user:t,account:r}){if(r&&t){e.accessToken=r.access_token,e.email=t.email,e.name=t.name;try{let r=await i(t.email);if(r){let t=function(e){if(!e||!Array.isArray(e))return"free";let t=e.find(e=>e.startsWith("siteoptz-plan-"));if(t){let e=t.replace("siteoptz-plan-","");return console.log("ðŸ“‹ Extracted plan from GHL tags:",e),e}return"free"}(r.tags||[]);e.plan=t,console.log("ðŸ“‹ JWT: Set user plan to:",t)}else e.plan="free",console.log("ðŸ“‹ JWT: No GHL contact, defaulting to free plan")}catch(t){console.error("JWT callback error:",t),e.plan="free"}}return e},session:async({session:e,token:t})=>(e.user&&(e.user.plan=t.plan||"free",e.user.email=t.email,e.user.name=t.name,console.log("ðŸ“‹ Session created for:",t.email,"with plan:",t.plan)),t.accessToken&&(e.accessToken=t.accessToken),e)},debug:!0,events:{async signIn({user:e,account:t,profile:r}){console.log("âœ… SignIn Event:",{email:e?.email,provider:t?.provider})},async signOut({session:e,token:t}){console.log("ðŸ‘‹ SignOut Event:",e?.user?.email)},async createUser({user:e}){console.log("ðŸ†• User Created:",e.email)},async session({session:e,token:t}){console.log("ðŸ“‹ Session Event:",e?.user?.email)}}},c=(0,a.default)(l);e.s(["authOptions",0,l,"default",0,c],11016);var u=e.i(11016),p=e.i(7031),d=e.i(81927),g=e.i(46432);let h=(0,o.hoist)(u,"default"),f=(0,o.hoist)(u,"config"),m=new n.PagesAPIRouteModule({definition:{kind:r.RouteKind.PAGES_API,page:"/api/auth/[...nextauth]",pathname:"/api/auth/[...nextauth]",bundlePath:"",filename:""},userland:u,distDir:".next",relativeProjectDir:""});async function v(e,r,n){m.isDev&&(0,g.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let o="/api/auth/[...nextauth]";o=o.replace(/\/index$/,"")||"/";let a=await m.prepare(e,r,{srcPage:o});if(!a){r.statusCode=400,r.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve());return}let{query:i,params:s,prerenderManifest:l,routerServerContext:c}=a;try{let t=e.method||"GET",n=(0,p.getTracer)(),a=n.getActiveScopeSpan(),u=m.instrumentationOnRequestError.bind(m),g=async a=>m.render(e,r,{query:{...i,...s},params:s,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:l.preview,propagateError:!1,dev:m.isDev,page:"/api/auth/[...nextauth]",internalRevalidate:null==c?void 0:c.revalidate,onError:(...t)=>u(e,...t)}).finally(()=>{if(!a)return;a.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let e=n.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=e.get("next.route");if(i){let e=`${t} ${i}`;a.setAttributes({"next.route":i,"http.route":i,"next.span_name":e}),a.updateName(e)}else a.updateName(`${t} ${o}`)});a?await g(a):await n.withPropagatedContext(e.headers,()=>n.trace(d.BaseServerSpan.handleRequest,{spanName:`${t} ${o}`,kind:p.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},g))}catch(e){if(m.isDev)throw e;(0,t.sendError)(r,500,"Internal Server Error")}finally{null==n.waitUntil||n.waitUntil.call(n,Promise.resolve())}}e.s(["config",0,f,"default",0,h,"handler",()=>v],34733)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__e71cf670._.js.map